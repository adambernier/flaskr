{% extends 'base.html' %}

{% block header %}
  <h1>{% block title %}Post{% endblock %}</h1>
  {% if g.user %}
    <a class="action" href="{{ url_for('blog.index') }}">Back to home</a>
  {% endif %}
{% endblock %}

{% block content %}
  <article class="post">
    <header>
      <div>
        <h1>{{ post['title'] }}</h1>
        <div class="about">by {{ post['username'] }} on {{ post['created'].strftime('%Y-%m-%d') }}</div>
      </div>
      {% if g.user['id'] == post['author_id'] %}
        <a class="action" href="{{ url_for('blog.update', id=post['id']) }}">Edit</a>
      {% endif %}
    </header>
    {{ post['body']|markdown }}
    <p><button id="click-btn" data-postid={{ post['id'] }}>Say thanks!</button></p>
    <p>Post thanked {{ thank_count }} time(s).</p>
    {% if post['tags'] %}
      {% set tag_list = post['tags'].split(' ') %}
      {% for tag in tag_list %}
        <a href="{{ url_for('blog.tag', page=1, tag_slug=tag) }}">{{ tag }}</a>
      {% endfor %}
    {% endif %}
  </article>

  {% block javascript %}
    <script type="text/javascript">
    $(document).ready(function() {
        $("#click-btn").click(function() {
            $.ajax({
                url: "{{ url_for('blog.thank', id=post['id']) }}",
                method: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data : {'postid': $('#click-btn').data('data-postid')},
                success: function(response) {
                    console.log(response);    
                },
                error: function(xhr) {
                    console.log(xhr);
                }
            });
        });
    });
    </script>
  {% endblock %}

{% endblock %}
